function newsletterRegister() { 
    if (validaNewsletter()) { 
        $.ajax({ type: "POST", url: "/cadastro_newsletter.php?ajax=true", data: $("form#newsletter").serialize(), headers: { ajaxSubmit: !0 }, dataType: "json", beforeSend: function () { loadingMsg("", "form#newsletter") }, complete: function (data) { $("form#newsletter").unblock() }, success: function (result) { $(".novidade-news .message").remove(); if (result.message) { $(".novidade-news").append('<div class="message news-erro">Verifique seu e-mail</div>') } else { $("#newsletter").prepend('<div class="message news-sucesso">SUCESSO!</div>') } } }) } }
function itensUpdate(obj) { $(".bt_compra").each(function (i, el) { let self = $(this).find(".campo_numero"); let value = self.attr("rel"); value = value + ""; if (Object.keys(obj).indexOf(value) > -1) { let qty = obj[value].quantity; self.val(qty); self.siblings("#cart_quantity_down").attr("disabled", !1); let btnComprar = $(this).find(".btn-comprar"); btnComprar.addClass("adicioned"); const i = btnComprar.children(); i.removeClass("fas fa-cart-plus"); 
i.addClass("far fa-check") } }) }
var sessionId = getUrlVars()["sid"]; 
sessionId = sessionId ? "&sid=" + sessionId : ""; 

function cartUpdate(product_id, qtdy, action = undefined) {
    let el; $(".product").each(function (value, i) { if ($(this).attr("id") == product_id) { $(this).find(".box_template .item_box_produto .bt_compra button.btn-success").html('<i class="fal fa-check"></i>') } }); var formData = new FormData(); if (action === "buy_now") { formData.set("id_produto", parseInt(product_id)); formData.set("qty_fixed", 1); formData.set("qty_updown", qtdy) } else if (action === "update_cart" || action === undefined) { if (qtdy === undefined || action === undefined) { action = "update_cart"; formData = null } else { formData.set(`quantity[${product_id}]`, qtdy) } } else if (action === "remove_product") { $(".bt_compra").each(function (index, value) { let el = $(this).find(".campo_numero"); let elAttr = el.attr("rel"); if (elAttr == product_id) { el.val(0); el.siblings(".btn-comprar").removeClass("adicioned").html("<i class='fas fa-cart-plus'></i>") } }); formData.set("id_produto", product_id); formData.set("qty_fixed", 1); formData.set("qty_updown", 0) }
    $.ajax({
        type: "POST", url: "/?action=" + action + sessionId, processData: !1, contentType: !1, data: formData, headers: { ajaxSubmit: !0 }, success: function (response, product_id) {
            var result = JSON.parse(response); if (result.change_url && !result.lastProductChanged && !result.productIdRemoved) { return window.location.replace(result.url) }
            $("button span.cart_items,.sidenav-shopping-cart span.cart_items").html(result.cartItemsCount); $(".sidenav-title span").text(result.cartItemsCount); $("div.sidenav-shopping-cart div.sidenav-body tr.product-" + result.productIdRemoved).remove(); $("div.sidenav-shopping-cart .sidenav-footer span").html(html_entity_decode(result.orderTotal)); $("div.sidenav-shopping-cart div.sidenav-body").unblock(); if (action == "buy_now") { $(".add-product-success").fadeIn(function () { setTimeout(function () { $(".add-product-success").fadeOut("slow") }, 2000) }); var product = jQuery.parseJSON(result.lastProductChanged); $(".name-product-success").html(product.name); $(".img-product-success").html(html_entity_decode(product.image)); $(".img-product-success").height(50).width(50); $(".quantity-product-success").html(`${product.quantity}x`); $(".price-product-success").html("R$ " + FormataMoeda(parseFloat(product.final_price_float) * product.quantity, 1)) }
            if (parseInt(result.cartItemsCount) !== undefined && parseInt(result.cartItemsCount) > 0) { var products = jQuery.parseJSON(result.cartItems); itensUpdate(products); var sidenav_body = $('<table class="table"><tbody class="tbody-cart"></tbody></table>'); var product_body = '<tr class="item product-{id}" val="{id}"><td class="item-col item-product has-modal"><div class="media"><div class="media-left"><div class="item-image">{imagem}</div></div><div class="media-body">{nome}</div>	</div></td><td class="item-col item-qtd text-center cart-size-normal">{quantidade}</td><td  class="item-col item-price text-center ng-binding">{preco}</td><td class="item-col item-remove text-right"><a class="remove-cart" id="{id}"><i class="fal fa-trash-alt"></i></a></td></tr>'; $.each(products, function () { var product = product_body.replace("{nome}", this.name).replace("{imagem}", html_entity_decode(this.image)).replace(/{id}/g, this.id).replace("{quantidade}", this.quantity).replace("{preco}", "R$ " + FormataMoeda(parseFloat(this.final_price_float) * this.quantity, 1)); $("tbody", $(sidenav_body)).append(product) }); $("div.sidenav-shopping-cart div.sidenav-body").html(sidenav_body); $("div.sidenav-shopping-cart div.sidenav-content .sidenav-footer").empty().append("<span>" + html_entity_decode(result.orderTotal) + '</span><a href="/pedido.php?' + sessionId + '" class="btn btn-lg btn-block btn-success">Finalizar pedido</a>') } else { $("div.sidenav-shopping-cart div.sidenav-body").html('<div class="no-item text-center">Você ainda não possui compras em seu carrinho</div>'); $("div.sidenav-shopping-cart .sidenav-footer").empty() }
        }, complete: function (result) {
            $(".remove-cart").click(function () { const productId = $(this).attr("id"); cartUpdate(productId, 0, "remove_product") })
            $(".loading").hide()
        }
    })
}
$(document).ready(function () {
    if ($(".sidenav-title span").text() !== "0") { cartUpdate() }
    $("button.btn-cart").hover(function (e) { cartUpdate() }); $(".product-page .product_details").prepend($(".product-page .texto_cabecalho_pagina")); $(".marks ul").each(function () { $(this).find(".mark-new").append("<span class='marcks_lancamento'><p>Lançamento <i class='fal fa-rocket'></i></p></span>"); $(this).find(".mark-hotdeal").append("<span class='marcks_ofertas'><p>Ofertas <i class='fal fa-tag'></i></p></span>"); $(this).find(".mark-exclusive").append("<span class='marcks_exclusivo'><p>Exclusivo <i class='fal fa-star'></i></p></span>") }); $(".btn-ajax").click(function (e) { e.preventDefault(); var product_id = $(this).attr("rel"); var qty_old = $(this).siblings("input").val(); var qty_new = Number(qty_old) + 1; cartUpdate(product_id, qty_new, "buy_now") }); $("#cart_updown i").click(function (e) {
        e.preventDefault(); $(".remove-product-success").fadeIn(function () { setTimeout(function () { $(".remove-product-success").fadeOut("slow") }, 2000) }); var product_id = $(this).parent().siblings(".campo_numero").attr("rel"); let qty_new = $(this).parent().siblings(".campo_numero").val(); qty_new = parseInt(qty_new); qty_new -= 1; if (qty_new === 0) { let btnComprar = $(this).parent().siblings(".btn-comprar"); btnComprar.addClass("adicioned"); const i = btnComprar.children(); i.addClass("fas fa-cart-plus"); i.removeClass("far fa-check"); $(this).parent().siblings(".campo_numero").val(qty_new); $(this).attr("disabled", "true"); return cartUpdate(product_id, qty_new, "remove_product") }
        cartUpdate(product_id, qty_new, "update_cart")
    }); $(".btn-comprar").each(function () { $(this).click(function (e) { let rel = $(this).attr("rel"); let el = $(this).siblings("input.campo_numero"); let quantityInput = el.val(); el.val(parseInt(quantityInput) + 1); qtdCart(rel) }) }); function qtdCart(rel) { let val = 0; $(".item").each(function (i, el) { const value = $(el).attr("val"); if (value === rel) { val = $(this).find(".item-qtd").text(); return val } }); val = parseInt(val) + 1; cartUpdate(rel, val) }
    var validCustomer = $.cookie("customer"); if (validCustomer != null) { validCustomer = JSON.parse(validCustomer); nameCustomer = html_entity_decode(validCustomer.name); nameCustomer = nameCustomer.replace("+", " "); $(".logged-out").hide(); $(".logged-in").show(); $(".logged-in .custumer-name").text(nameCustomer); $(".menu_lojaiset .login-texto").html("MINHA CONTA / MEUS PEDIDOS") } else { $(".logged-out").show(); $(".logged-in").hide() }
}); $(".btn-closeMenu, .btn-openMenu").on("click", function () { $(".menu-mobile").toggleClass("is-active"); $("body").toggleClass("fixed") }); $("#lojaiset > ul > li").each(function () { if (!$(this).find("ul li").length) { $(this).find(".submenu-button").css("display", "none") } }); $(".submenu-button").on("click", function () { $(this).next().next().toggleClass("open"); $(this).toggleClass("submenu-opened") })